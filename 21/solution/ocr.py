import os
from PIL import Image


HEIGHT = 54
WIDTH = 58

PATTERNS = {
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,94,255,255,227,8,0,0,0,21,255,250,0,0,0,0,0,0,0,0,0,226,0,0,0': 'A',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,180,255,133,0,0,0,0,0,0,0,0,0,11,255,255,0,0,0,0,0,0,0,0,0,0,226,0,0,0': 'B',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,122,255,255,126,0,0,0,0,0,0,221,255,255,34,0,0,0,0,0,0,0,0,226,0,0,0': 'C',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,255,255,203,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,226,0,0,0': 'D',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,144,255,255,75,0,0,0,0,0,0,0,0,128,255,210,0,0,0,0,0,0,0,0,46,255,255,59,0,0,0,0,0,0,0,0,226,0,0,0': 'E',
    '0,0,0,0,18,159,0,0,0,0,63,255,255,14,0,0,0,0,0,0,0,0,7,243,255,255,255,255,255,54,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,42,0,0,0,0,226,0,0,0': 'F',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,240,255,255,107,0,169,255,255,17,0,0,0,0,0,246,255,255,226,255,255,153,0,0,0,0,0,0,0,149,255,249,0,0,0,0,0,226,0,0,0': 'G',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,255,255,255,82,0,0,0,0,0,0,0,0,0,0,6,227,181,0,0,0,0,0,226,0,0,0': 'H',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,0,0,0,0,0,53,255,236,0,0,0,0,47,255,255,255,10,0,0,0,0,0,0,0,0,136,255,255,85,0,0,0,0,0,0,226,0,0,0': 'I',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,54,255,255,117,29,21,27,32,39,46,56,69,93,112,148,237,255,255,244,0,0,0,0,0,226,0,0,0': 'J',
    '0,0,0,0,18,159,0,0,23,241,255,255,255,255,255,255,255,254,234,190,125,69,32,9,2,1,95,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,226,0,0,0': 'K',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,135,255,255,37,0,0,0,0,0,0,0,0,73,119,61,0,0,0,0,0,0,0,0,0,0,255,255,221,0,0,0,0,0,0,0,0,226,0,0,0': 'L',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,0,0,0,0,85,255,255,236,255,255,181,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,226,0,0,0': 'M',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,179,255,255,21,0,0,0,0,0,0,0,0,0,0,0,0,0,0,226,0,0,0': 'N',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,30,255,253,0,0,0,0,0,0,0,0,0,238,255,255,255,31,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,226,0,0,0': 'O',
    '0,0,0,0,18,159,0,0,0,0,0,185,255,188,0,0,0,0,146,255,255,168,195,255,255,16,0,0,0,4,255,255,255,255,255,255,255,3,0,0,0,0,187,255,87,0,0,0,0,0,226,0,0,0': 'P',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,0,59,255,255,207,0,0,0,0,0,0,115,255,255,67,0,0,0,0,0,0,0,151,255,255,91,0,0,0,0,0,0,0,0,0,226,0,0,0': 'Q',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,28,92,169,227,253,255,255,255,255,255,154,0,0,79,255,187,0,0,0,0,0,0,0,0,0,0,0,0,0,226,0,0,0': 'R',
    '0,0,0,0,18,159,0,0,0,0,95,255,255,255,89,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,22,255,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,226,0,0,0': 'S',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,0,0,0,0,0,174,255,255,113,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,226,0,0,0': 'T',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,255,255,221,0,0,0,0,0,0,0,0,0,69,255,255,189,0,0,0,0,0,0,0,226,0,0,0': 'U',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,0,0,4,10,7,76,255,255,163,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,59,0,0,0,0,0,0,0,0,0,226,0,0,0': 'V',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,0,0,185,255,76,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,250,255,25,0,0,0,0,0,0,0,0,0,0,0,226,0,0,0': 'W',
    '0,0,0,0,18,159,0,0,0,0,0,0,0,0,0,0,211,255,255,77,0,187,255,255,135,0,0,0,94,255,255,227,0,0,0,0,0,0,0,162,255,255,65,0,0,0,0,0,0,0,226,0,0,0': 'X',
    '0,0,0,0,18,159,0,0,0,0,153,255,230,0,0,0,0,128,255,255,74,0,0,0,0,0,0,0,0,0,0,247,255,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,226,0,0,0': 'Y',
}


def recognize_code(in_file):
    if not os.path.isfile(in_file):
        exit()
    frame = Image.open(in_file)
    pixels = list(frame.getdata())
    width, height = frame.size
    pixels = [pixels[i * width:(i + 1) * width] for i in range(height)]

    output = ''
    for i in range(7):
        x = i*WIDTH
        pattern = []
        for z in range(HEIGHT):
            pattern.append(str(pixels[z][x+z][3]))
        pattern = ','.join(pattern)
        if pattern in PATTERNS:
            output += PATTERNS[pattern]
        else:
            print('Unrecognized pattern:', pattern)

    return output
